library(tidyverse)
library(ggforce)
library(grDevices)

df_passeriformes <- read.csv("Data_Rivage_7Avril2024.csv", sep=";")

### PCA ###

pca <- ade4::dudi.pca(scale(log10(df_passeriformes[,c(7:14)])), scannf = FALSE, nf = 4)

cumsum(pca$eig / sum(pca$eig))

pca$co

### built datasets ###

colnames(pca$li) <- c("PC1", "PC2", "PC3", "PC4")

data.plot <- data.frame(pca$li, EX = df_passeriformes$Statu, HC = df_passeriformes$HC, IUCN = df_passeriformes$IUCN)

data.plot$Groups <- paste(df_passeriformes$HC, df_passeriformes$Status, sep="_")

### Honeycreepers dataset ###

All_honeycreepers <- filter(data.plot, Groups%in%c("HC_EXTINCT","HC_EXTANT"))

Extant_honeycreepers <- filter(Honey, Groups == "HC_EXTANT")

hull_all <-  data.plot %>% slice(chull(PC1, PC2))

hull_honey <-  All_honeycreepers %>% slice(chull(PC1, PC2))

hull_extant <-  Extant_honeycreepers %>% slice(chull(PC1, PC2))


ggplot(data.plot, aes(x=PC1, y=PC2)) + 
  geom_point(shape=19, color="grey80", alpha=0.5, size=0.5) +
  geom_hline(yintercept = 0, lty=3) + geom_vline(xintercept = 0, lty=3) + theme_bw() + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) + labs(x="PC1 (68%)", y="PC2 (12%)") +
  geom_polygon(data = hull_honey, aes(x = PC1, y = PC2),
               colour = NA, size = 0.4, alpha = 0.5, fill="grey20", lty=1) +
  geom_polygon(data = hull_all, aes(x = PC1, y = PC2),
               colour = NA, size = 0.4, alpha = 0.5, fill="grey80", lty=1) +
  geom_polygon(data = hull_extant, aes(x = PC1, y = PC2),
               colour = NA, size = 0.4, alpha = 0.5, fill="black", lty=1) +
  theme(legend.position="none") + ylim(c(-4, 4)) + 
  geom_point(data=Honey, aes(x=PC1, y=PC2, color=IUCN), size=1) + 
  scale_color_manual(values  = c("LC"="mediumseagreen", "NT"="olivedrab2", 
                                 "VU"="gold2", "EN"="darkorange2", 
                                 "CR"="firebrick2", "EX" = "black"))




